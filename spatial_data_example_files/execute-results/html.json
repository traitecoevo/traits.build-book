{
  "hash": "1eca58d04aa2a93e427a7066214f4d7a",
  "result": {
    "markdown": "\n# Tutorial: Using AusTraits with spatial data\n\nThis tutorial is based on [this great tutorial](https://labs.ala.org.au/posts/2023-08-28_alternatives-to-box-plots/post.html) by Dax Kellie and Shandiya Balasubramaniam from the ALA team.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# remotes::install_github(\"traitecoevo/austraits\")\nlibrary(tidyverse)\nlibrary(austraits)\n```\n:::\n\n\n\nLoad austraits\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmost_recent <- austraits::get_versions()[[\"doi\"]][1]\n\nmost_recent\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"10.5281/zenodo.10156222\"\n```\n:::\n\n```{.r .cell-code}\naustraits <- austraits::load_austraits(doi = most_recent)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading data from 'data/austraits/austraits-5.0.0.rds'\n```\n:::\n:::\n\nExtract leaf mass per area (LMA) data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# You can use `lookup_trait()` to search for traits containing keywords\naustraits::lookup_trait(austraits, \"leaf_mass\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"leaf_mass_per_area\"           \"leaf_mass_fraction\"          \n[3] \"leaf_mass_to_stem_mass_ratio\"\n```\n:::\n\n```{.r .cell-code}\n# Get trait data\nleaf_mass <- austraits %>%\n  austraits::extract_trait(\"leaf_mass_per_area\") %>%\n  purrr::pluck(\"traits\") # Grab the traits table from the list of austraits tables\n```\n:::\n\n\n\nFilter to six species in the dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsample_names <- c(\"Cryptocarya rigida\", \"Pteridium esculentum\",\n                  \"Eucalyptus baxteri\", \"Melaleuca armillaris\",\n                  \"Eucalyptus wandoo\", \"Eucalyptus piperita\")\n\nleaf_mass_sample <- leaf_mass %>% filter(taxon_name %in% sample_names)\n```\n:::\n\n\n\nPlot raincloud plot of LMA for the six species\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(c(\"ggdist\", \"gghalves\", \"ggtext\"))\n# remotes::install_github(\"olihawkins/pilot\")\nggplot(\n  data = leaf_mass_sample,\n  aes(x = taxon_name %>% stringr::str_wrap(10) %>% reorder(value),\n      y = value,\n      colour = taxon_name,\n      fill = taxon_name)\n) +\n  ggdist::stat_halfeye(\n    adjust = .4,\n    width = .87,\n    colour = NA) +\n  gghalves::geom_half_point(\n    side = \"l\",\n    range_scale = .3,\n    alpha = .6,\n    size = 2.2) +\n  geom_boxplot(\n    aes(colour = taxon_name,\n        colour = after_scale(colorspace::darken(colour, .7))),\n    width = .12, # Adjust box width\n    fill = NA,\n    size = 1.1, # Size of box line\n    outlier.shape = NA # Remove outlier points\n  ) +\n  coord_flip() +\n  labs(\n    x = \"Species\",\n    y = \"Leaf mass per area (g/m<sup>2</sup>)\") +\n  scale_y_continuous(\n    breaks = c(0, 100, 200, 300, 400),\n    labels = c(0, 100, 200, 300, 400),\n    limits = c(0, 400),\n    expand = c(0,0)) +\n  pilot::scale_color_pilot() +\n  pilot::scale_fill_pilot() +\n  pilot::theme_pilot(\n    grid = \"\",\n    axes = \"b\") +\n  theme(\n    legend.position = \"none\",\n    axis.title.x = ggtext::element_markdown(),\n    axis.text.y = element_text(face = \"italic\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Duplicated aesthetics after name standardisation: colour\n```\n:::\n\n::: {.cell-output-display}\n![](spatial_data_example_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\nPlot the species distributions of these six species with ALA occurrence data (using `galah`)\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(c(\"galah\", \"sf\", \"ozmaps\"))\nlibrary(galah)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'galah'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:stats':\n\n    filter\n```\n:::\n\n```{.r .cell-code}\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLinking to GEOS 3.11.2, GDAL 3.6.2, PROJ 9.2.0; sf_use_s2() is TRUE\n```\n:::\n\n```{.r .cell-code}\n# Configurate `galah` to use an email that has been registered with the ALA (https://auth.ala.org.au/userdetails/registration/createAccount)\ngalah_config(email = \"sophie.yang917@gmail.com\", verbose = FALSE)\n\n# Download data\nplants <- galah_call() %>%\n  galah_identify(sample_names) %>%\n  galah_apply_profile(ALA) %>%\n  atlas_occurrences()\n\n# Recategorise subspecies into species categories\nplants <- plants %>%\n  drop_na(decimalLatitude, decimalLatitude) %>%\n  mutate(names = case_when(\n    str_detect(scientificName, \"Eucalyptus wandoo\") ~ \"Eucalyptus wandoo\",\n    str_detect(scientificName, \"Pentameris airoides\") ~ \"Pentameris airoides\",\n    str_detect(scientificName, \"Melaleuca armillaris\") ~ \"Melaleuca armillaris\",\n    str_detect(scientificName, \"Pteridium esculentum\") ~ \"Pteridium esculentum\",\n    .default = scientificName)\n  )\n\n# Join median LMAs for each species to `plants` tibble\nplants_lma <- leaf_mass_sample %>%\n  group_by(taxon_name) %>%\n  summarise(median_lma = median(value) %>% round(1)) %>%\n  right_join(plants, by = join_by(taxon_name == scientificName)) %>%\n  rename(scientificName = taxon_name) %>%\n  drop_na(median_lma) # Remove NAs for unmatched subspecies\n\n# Australia map\naus <- ozmaps::ozmap_country %>%\n  st_transform(crs = st_crs(4326))\n\n# Map points\nggplot() +\n  geom_sf(\n    data = aus,\n    colour = \"grey60\",\n    fill = NA) +\n  geom_point(\n    data = plants_lma,\n    aes(x = decimalLongitude,\n        y = decimalLatitude,\n        colour = names),\n    shape = 16,\n    alpha = 0.4) +\n  pilot::scale_color_pilot() +\n  pilot::theme_pilot() +\n  coord_sf(\n    xlim = c(110, 155),\n    ylim = c(-45, -10)) +\n  facet_wrap(~ names, ncol = 3) +\n  geom_text(\n    data = plants_lma,\n    mapping = aes(x = 116, y = -11,\n                  label = glue::glue(\"LMA = {median_lma}\"),\n                  group = names),\n    colour = \"grey40\",\n    family = theme_get()$text$family, # use theme settings\n    size = 3.5,\n    lineheight = 0.92) +\n  theme(\n    legend.position = \"none\",\n    axis.title.x = element_blank(),\n    axis.title.y = element_blank(),\n    axis.text.x = element_blank(),\n    axis.text.y = element_blank(),\n    panel.border = element_rect(\n      linewidth = 1,\n      colour = \"grey90\",\n      fill = NA)\n  )\n```\n\n::: {.cell-output-display}\n![](spatial_data_example_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::",
    "supporting": [
      "spatial_data_example_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}